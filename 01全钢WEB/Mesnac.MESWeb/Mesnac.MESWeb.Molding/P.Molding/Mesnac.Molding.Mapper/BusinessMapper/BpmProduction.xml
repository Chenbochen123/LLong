<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Mesnac.Molding.Mapper.BusinessMapper.BpmProduction"
	xmlns="http://ibatis.apache.org/mapping"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

   <statements>
	 <!--查询数据-->
    <sql id="includeSelect">
      <![CDATA[SELECT * FROM BPM_PRODUCTION ]]>
    </sql>
    <!--查询条件-->
    <sql id="includeWhere">
	  <dynamic prepend="WHERE">
        <isNotNull property="where.ObjId" prepend="AND">
          <![CDATA[OBJID = #where.ObjId#]]>
        </isNotNull>
        <isNotNull property="where.RecordUserId" prepend="AND">
          <![CDATA[RECORD_USER_ID = #where.RecordUserId#]]>
        </isNotNull>
        <isNotNull property="where.RecordTime" prepend="AND">
          <![CDATA[RECORD_TIME = #where.RecordTime#]]>
        </isNotNull>
        <isNotNull property="where.BackupFlag" prepend="AND">
          <![CDATA[BACKUP_FLAG = #where.BackupFlag#]]>
        </isNotNull>
        <isNotNull property="where.BackupTime" prepend="AND">
          <![CDATA[BACKUP_TIME = #where.BackupTime#]]>
        </isNotNull>
        <isNotNull property="where.DeleteFlag" prepend="AND">
          <![CDATA[DELETE_FLAG = #where.DeleteFlag#]]>
        </isNotNull>
        <isNotNull property="where.FactoryId" prepend="AND">
          <![CDATA[FACTORY_ID = #where.FactoryId#]]>
        </isNotNull>
        <isNotNull property="where.GreenTyreNo" prepend="AND">
          <![CDATA[GREEN_TYRE_NO = #where.GreenTyreNo#]]>
        </isNotNull>
        <isNotNull property="where.PlanId" prepend="AND">
          <![CDATA[PLAN_ID = #where.PlanId#]]>
        </isNotNull>
        <isNotNull property="where.PlanDetailId" prepend="AND">
          <![CDATA[PLAN_DETAIL_ID = #where.PlanDetailId#]]>
        </isNotNull>
        <isNotNull property="where.ShiftMasterId" prepend="AND">
          <![CDATA[SHIFT_MASTER_ID = #where.ShiftMasterId#]]>
        </isNotNull>
        <isNotNull property="where.ShiftDetailId" prepend="AND">
          <![CDATA[SHIFT_DETAIL_ID = #where.ShiftDetailId#]]>
        </isNotNull>
        <isNotNull property="where.BeginTime" prepend="AND">
          <![CDATA[BEGIN_TIME = #where.BeginTime#]]>
        </isNotNull>
        <isNotNull property="where.EndTime" prepend="AND">
          <![CDATA[END_TIME = #where.EndTime#]]>
        </isNotNull>
        <isNotNull property="where.IsFirst" prepend="AND">
          <![CDATA[IS_FIRST = #where.IsFirst#]]>
        </isNotNull>
        <isNotNull property="where.SeqIndex" prepend="AND">
          <![CDATA[SEQ_INDEX = #where.SeqIndex#]]>
        </isNotNull>
        <isNotNull property="where.Remark" prepend="AND">
          <![CDATA[REMARK = #where.Remark#]]>
        </isNotNull>
        <isNotNull property="where.BlFlag" prepend="AND">
          <![CDATA[BL_FLAG = #where.BlFlag#]]>
        </isNotNull>
        <isNotNull property="where.PlanIdOrigin" prepend="AND">
          <![CDATA[PLAN_ID_ORIGIN = #where.PlanIdOrigin#]]>
        </isNotNull>
        <isNotNull property="where.PlanDetailIdOrigin" prepend="AND">
          <![CDATA[PLAN_DETAIL_ID_ORIGIN = #where.PlanDetailIdOrigin#]]>
        </isNotNull>
        <isNotNull property="where.MaterChangeFlag" prepend="AND">
          <![CDATA[MATER_CHANGE_FLAG = #where.MaterChangeFlag#]]>
        </isNotNull>
        <isNotNull property="where.MaterChangeTime" prepend="AND">
          <![CDATA[MATER_CHANGE_TIME = #where.MaterChangeTime#]]>
        </isNotNull>
        <isNotNull property="where.ShiftMasterIdOrigin" prepend="AND">
          <![CDATA[SHIFT_MASTER_ID_ORIGIN = #where.ShiftMasterIdOrigin#]]>
        </isNotNull>
        <isNotNull property="where.MonthFlag" prepend="AND">
          <![CDATA[MONTH_FLAG = #where.MonthFlag#]]>
        </isNotNull>
      </dynamic>
    </sql>
    <!--排序条件-->
    <sql id="includeOrderString">
      <isNotNull property="OrderString" prepend="">
        ORDER BY $OrderString$
      </isNotNull>
    </sql>

    <!--查询实例说明-->
    <select id="GetPageDataByReader" parameterClass="map" resultClass="Row"> 
	  <include refid="includeSelect"/>
      <include refid="includeWhere"/>
      <include refid="includeOrderString"/>
    </select>
     <!--获取数据库服务器当前时间-->
     <select id="GetSysDateTime" parameterClass="map" resultClass="Row">
       select sysdate SYS_DATE from dual
     </select>

     <!--获取成型胎胚状态记录-->
     <select id="wsGetMoldingTyreStateInfo" parameterClass="map" resultClass="Row">
       select *
       from SPP_TYRE_STATE
       where DELETE_FLAG = 0
       and GREEN_TYRE_NO = #GreenTyreNo#
     </select>

     <!--插入成型胎胚状态记录-->
     <insert id="wsInsertMoldingTyreStateInfo" parameterClass="map" resultClass="int">
       insert into SPP_TYRE_STATE (OBJID, RECORD_TIME, DELETE_FLAG, TYRE_STATE, GREEN_TYRE_NO)
       values (SEQ_SPP_TYRE_STATE.nextval, sysdate, 0, 319, #GreenTyreNo#)
     </insert>
     <!--获取胎胚生产信息-->
     <select id="GetGreenTyreProductInfo" parameterClass="map" resultClass="Row">
       <![CDATA[
      SELECT T0.GREEN_TYRE_NO,T2.MATERIAL_NAME,T2.MATERIAL_CODE,T1.MATERIAL_ID,T3.SHIFT_DATE,T4.EQUIP_NAME,T5.SHIFT_NAME,T6.CLASS_NAME FROM BPM_PRODUCTION T0
      LEFT JOIN BPP_PLAN_DETAIL T1 ON T1.OBJID = T0.PLAN_DETAIL_ID
      LEFT JOIN V_BBM_MATERIALINFO T2 ON T2.ObjId = T1.MATERIAL_ID
      LEFT JOIN BPM_SHIFT_MASTER T3 ON T3.OBJID = T0.SHIFT_MASTER_ID
      LEFT JOIN SBE_EQUIP T4 ON T4.OBJID = T3.EQUIP_ID
      LEFT JOIN SSB_SHIFT T5 ON T5.OBJID = T3.SHIFT_ID
      LEFT JOIN SSB_CLASS T6 ON T6.OBJID =T3.CLASS_ID
      ]]>
       <dynamic prepend="WHERE">
         <isNotNull property="GreenTyreNo" prepend="AND">
           <![CDATA[T0.GREEN_TYRE_NO = #GreenTyreNo#]]>
         </isNotNull>
       </dynamic>
     </select>

     <!--按机台班组统计产量-->
     <select id="ProductionStat@EquipAndClass" parameterClass="map" resultClass="Row">
       <![CDATA[ 
          select t1.EQUIP_ID, t2.EQUIP_NAME 
          , sum(case when t1.CLASS_ID = 1 then 1 else 0 end) TOTAL_1 
          , sum(case when t1.CLASS_ID = 2 then 1 else 0 end) TOTAL_2 
          , sum(case when t1.CLASS_ID = 3 then 1 else 0 end) TOTAL_3 
          , sum(case when t1.CLASS_ID = 4 then 1 else 0 end) TOTAL_4 
          , sum(case when nvl(t1.CLASS_ID, 0) not in (1, 2, 3, 4) then 1 else 0 end) TOTAL_N 
          , COUNT(*) TOTAL 
          , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
          from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
          max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
          max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
          (
          select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
          tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
          left join bpp_plan tp on tp.objid= t0.plan_id
          left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
          left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
          left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
          where t0.delete_flag = 0
          )t
          group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
          left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
          left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
        ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
          group by t1.EQUIP_ID, t2.EQUIP_NAME 
        ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
          order by $OrderString$
          ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
          order by t2.EQUIP_NAME
          ]]>
       </isNull>
     </select>

     <!--按机台规格班组统计产量-->
     <select id="ProductionStat@EquipAndMaterAndClass" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME as MATERIAL_CODE , t3.MATERIAL_CODE MATERIAL_NAME
        , sum(case when T1.CLASS_ID = 1 then 1 else 0 end) TOTAL_1
        , sum(case when T1.CLASS_ID = 2 then 1 else 0 end) TOTAL_2
        , sum(case when T1.CLASS_ID = 3 then 1 else 0 end) TOTAL_3
        , sum(case when T1.CLASS_ID = 4 then 1 else 0 end) TOTAL_4
        , sum(case when nvl(T1.CLASS_ID, 0) not in (1, 2, 3, 4) then 1 else 0 end) TOTAL_N
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME, t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>

     <!--按规格班组统计产量-->
     <select id="ProductionStat@MaterAndClass" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.MATERIAL_ID, t3.MATERIAL_NAME as MATERIAL_CODE,t3.MATERIAL_CODE MATERIAL_NAME
        , sum(case when T1.CLASS_ID = 1 then 1 else 0 end) TOTAL_1
        , sum(case when T1.CLASS_ID = 2 then 1 else 0 end) TOTAL_2
        , sum(case when T1.CLASS_ID = 3 then 1 else 0 end) TOTAL_3
        , sum(case when T1.CLASS_ID = 4 then 1 else 0 end) TOTAL_4
        , sum(case when nvl(T1.CLASS_ID, 0) not in (1, 2, 3, 4) then 1 else 0 end) TOTAL_N
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag)t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.MATERIAL_ID, t3.MATERIAL_NAME,t3.MATERIAL_CODE 
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
     </select>

     <!--按机台班次统计产量-->
     <select id="ProductionStat@EquipAndShift" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.EQUIP_ID, t2.EQUIP_NAME 
        , sum(case when T1.SHIFT_ID = 1 then 1 else 0 end) TOTAL_1 
        , sum(case when T1.SHIFT_ID = 2 then 1 else 0 end) TOTAL_2 
        , sum(case when T1.SHIFT_ID = 3 then 1 else 0 end) TOTAL_3 
        , sum(case when nvl(T1.SHIFT_ID, 0) not in (1, 2, 3) then 1 else 0 end) TOTAL_N 
        , COUNT(*) TOTAL 
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.EQUIP_ID, t2.EQUIP_NAME 
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>

     <!--按机台规格班次统计产量-->
     <select id="ProductionStat@EquipAndMaterAndShift" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME as MATERIAL_CODE , t3.MATERIAL_CODE MATERIAL_NAME
        , sum(case when T1.SHIFT_ID = 1 then 1 else 0 end) TOTAL_1
        , sum(case when T1.SHIFT_ID = 2 then 1 else 0 end) TOTAL_2
        , sum(case when T1.SHIFT_ID = 3 then 1 else 0 end) TOTAL_3
        , sum(case when nvl(T1.SHIFT_ID, 0) not in (1, 2, 3) then 1 else 0 end) TOTAL_N
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME, t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>

     <!--按规格班次统计产量-->
     <select id="ProductionStat@MaterAndShift" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.MATERIAL_ID,t3.MATERIAL_NAME as MATERIAL_CODE, t3.MATERIAL_CODE MATERIAL_NAME
        , sum(case when T1.SHIFT_ID = 1 then 1 else 0 end) TOTAL_1
        , sum(case when T1.SHIFT_ID = 2 then 1 else 0 end) TOTAL_2
        , sum(case when T1.SHIFT_ID = 3 then 1 else 0 end) TOTAL_3
        , sum(case when nvl(T1.SHIFT_ID, 0) not in (1, 2, 3) then 1 else 0 end) TOTAL_N
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.MATERIAL_ID, t3.MATERIAL_NAME ,t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
     </select>

     <!--按机台规格统计产量-->
     <select id="ProductionStat@EquipAndMater" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME as MATERIAL_CODE, t3.MATERIAL_CODE MATERIAL_NAME
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME , t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>

     <!--按人员机台规格统计产量-->
     <select id="ProductionStat@EmpAndEquipAndMater" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t10.USER_NAME EMP_NAME1,t11.USER_NAME EMP_NAME2,t12.USER_NAME EMP_NAME3, t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME as MATERIAL_CODE, t3.MATERIAL_CODE MATERIAL_NAME
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
        left join SSB_USER T10 on t1.主机 = t10.OBJID
        left join SSB_USER T11 on t1.副机 = t11.OBJID
        left join SSB_USER T12 on t1.帮车 = t12.OBJID
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t10.USER_NAME,t11.USER_NAME,t12.USER_NAME, t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID,t3.MATERIAL_NAME , t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t10.USER_NAME,t11.USER_NAME,t12.USER_NAME, t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>

     <!--按人员产机台班次统计产量-->
     <select id="ProductionStat@EmpAndEquipAndShift" parameterClass="map" resultClass="Row">
       <![CDATA[ 
        select t10.USER_NAME EMP_NAME1,t11.USER_NAME EMP_NAME2,t12.USER_NAME EMP_NAME3, t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID, t3.MATERIAL_CODE MATERIAL_NAME
        , sum(case when T1.SHIFT_ID = 1 then 1 else 0 end) TOTAL_1
        , sum(case when T1.SHIFT_ID = 2 then 1 else 0 end) TOTAL_2
        , sum(case when T1.SHIFT_ID = 3 then 1 else 0 end) TOTAL_3
        , sum(case when nvl(T1.SHIFT_ID, 0) not in (1, 2, 3) then 1 else 0 end) TOTAL_N
        , COUNT(*) TOTAL
        , sum(case when nvl(t1.bl_flag,0) = 1 then 1 else 0 end ) TOTAL_BL
        from (select t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,
        max(decode(t.worker_id8,82,t.worker_id1,null)) 主机,max(decode(t.worker_id8,83,t.worker_id1,null)) 副机,
        max(decode(t.worker_id8,85,t.worker_id1,null)) 帮车,t.bl_flag from
        (
        select t0.objid,t0.record_time,t0.begin_time,tpd.material_id,t0.bl_flag,
        tp.equip_id,tsm.shift_id,tsm.class_id,tsm.shift_date,tsd.worker_id1,tsd.worker_id8 from BPM_PRODUCTION t0
        left join bpp_plan tp on tp.objid= t0.plan_id
        left join bpp_plan_detail tpd on tpd.objid= t0.plan_detail_id
        left join bpm_shift_master tsm on tsm.objid = t0.shift_master_id
        left join bpm_shift_detail tsd on tsd.master_id = tsm.objid
        where t0.delete_flag = 0
        )t
        group by t.objid,t.record_time,t.begin_time,t.material_id,t.equip_id,t.shift_id,t.class_id,t.shift_date,t.bl_flag) t1 
        left join SBE_EQUIP t2 on t1.EQUIP_ID = t2.OBJID 
        left join V_BBM_MATERIAL t3 on t1.MATERIAL_ID = t3.OBJID 
        left join SSB_USER T10 on t1.主机 = t10.OBJID 
        left join SSB_USER T11 on t1.副机 = t11.OBJID 
        left join SSB_USER T12 on t1.帮车 = t12.OBJID 
      ]]>
       <dynamic prepend="where">
         <isNotNull property="where.BeginDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE >= #where.BeginDate#]]>
         </isNotNull>
         <isNotNull property="where.EndDate" prepend="AND">
           <![CDATA[t1.SHIFT_DATE <= #where.EndDate#]]>
         </isNotNull>
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t1.BEGIN_TIME < #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftId" prepend="AND">
           <![CDATA[t1.SHIFT_ID = #where.ShiftId#]]>
         </isNotNull>
         <isNotNull property="where.ClassId" prepend="AND">
           <![CDATA[t1.CLASS_ID = #where.ClassId#]]>
         </isNotNull>
         <isNotNull property="where.EquipMinorTypeId" prepend="AND">
           <![CDATA[t2.MINOR_TYPE_ID = #where.EquipMinorTypeId#]]>
         </isNotNull>
         <isNotNull property="where.EquipId" prepend="AND">
           <![CDATA[t1.EQUIP_ID = #where.EquipId#]]>
         </isNotNull>
         <isNotNull property="where.MaterialId" prepend="AND">
           <![CDATA[t1.MATERIAL_ID = #where.MaterialId#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[ 
        group by t10.USER_NAME,t11.USER_NAME,t12.USER_NAME, t1.EQUIP_ID, t2.EQUIP_NAME, t1.MATERIAL_ID, t3.MATERIAL_CODE
      ]]>
       <isNotNull property="OrderString" prepend="">
         <![CDATA[
        order by $OrderString$
        ]]>
       </isNotNull>
       <isNull property="OrderString" prepend="">
         <![CDATA[
        order by t10.USER_NAME,t11.USER_NAME,t12.USER_NAME, t2.EQUIP_NAME
        ]]>
       </isNull>
     </select>
     <select id="GetNoCuringDetail" parameterClass="map" resultClass="Row">
       <![CDATA[
   select t.green_tyre_no,t.material_id,t.material_name,T.EQUIP_NAME,T.CLASS_NAME,T.SHIFT_NAME,t10.user_name emp1_name,t11.user_name emp2_name,
   t12.user_name emp3_name,t.record_time ,
       DECODE(NVL(T17.STORE_PLACE_CODE, ''), '',
              DECODE(NvL(T18.STORE_PLACE_CODE, ''), '', '', NvL(T18.STORE_PLACE_CODE, '')),
              NVL(T17.STORE_PLACE_CODE, '')) STORE_PLACE_CODE from
  (
  (select t0.green_tyre_no,t0.record_time,t1.material_id,t2.material_name,T5.EQUIP_NAME,T6.CLASS_NAME,T7.SHIFT_NAME,
   max(decode(t9.worker_id8,82,t9.worker_id1,null)) emp1,max(decode(t9.worker_id8,83,t9.worker_id1,null)) emp2,
   max(decode(t9.worker_id8,85,t9.worker_id1,null)) emp3
    from bpm_production t0
    left join bpp_plan_detail t1 on t1.objid = t0.plan_detail_id
    left join v_bbm_materialinfo t2 on t2.ObjId = t1.material_id
    left join bpm_shift_master t4 on t4.objid = t0.shift_master_id
    left join sbe_equip t5 on t5.objid = t4.equip_id
    left join ssb_class t6 on t6.objid = t4.class_id
    left join ssb_shift t7 on t7.objid =t4.shift_id
    left join bpp_plan t8 on t8.objid = t0.plan_id
    LEFT JOIN BPM_SHIFT_DETAIL T9 ON T9.MASTER_ID = T4.OBJID
    where not exists(select 1 from cpp_curing_production t3 where t3.green_tyre_no = t0.green_tyre_no)
    and t0.delete_flag=0
    ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t8.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t8.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[t4.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[t4.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[t4.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[t2.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
         <isNotNull property="where.MaterialID" prepend="AND">
           <![CDATA[t1.material_id = #where.MaterialID#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[
    group by t0.green_tyre_no,t0.record_time,t1.material_id,t2.material_name,T5.EQUIP_NAME,T6.CLASS_NAME,T7.SHIFT_NAME
    )t
    left join ssb_user t10 on t10.objid = t.emp1
    left join ssb_user t11 on t11.objid = t.emp2
    left join ssb_user t12 on t12.objid = t.emp3
    LEFT JOIN BSM_STORAGE_DETAIL T13 ON T.GREEN_TYRE_NO = T13.GREEN_TYRE_NO
    LEFT JOIN BSM_STORAGE_MAIN T14 ON T13.STORAGE_MAIN_ID = T14.OBJID
    LEFT JOIN BSM_STORE_PLACE T17 ON T14.STORE_PLACE_ID = T17.OBJID
    LEFT JOIN CSM_STORAGE_DETAIL T15 ON T.GREEN_TYRE_NO = T15.GREEN_TYRE_NO
    LEFT JOIN CSM_STORAGE_MAIN T16 ON T15.STORAGE_MAIN_ID = T16.OBJID
    LEFT JOIN CSM_STORE_PLACE T18 ON T16.STORE_PLACE_ID = T18.OBJID
    )
    ]]>
     </select>
     <select id="GetNoCuringInfo" parameterClass="map" resultClass="Row">
       <![CDATA[
    select tt.material_id,tt.material_name,tt.total_count,nvl(td.no_curing_count,0)no_curing_count from 
    (select tm.material_id,tm.material_name,count(*) total_count from bpm_production t 
    left join bpp_plan_detail tpd on tpd.objid = t.plan_detail_id
    left join v_bbm_materialinfo tm on tm.ObjId = tpd.material_id
    left join bpm_shift_master tsm on tsm.objid = t.shift_master_id
    left join sbe_equip te on te.objid = tsm.equip_id
    left join ssb_class tc on tc.objid = tsm.class_id
    left join ssb_shift ts on ts.objid =tsm.shift_id
    left join bpp_plan tp on tp.objid = t.plan_id
    where t.delete_flag=0
    ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[tp.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[tp.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[tsm.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[tsm.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[tsm.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[tm.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
       </dynamic>
       <![CDATA[
    group by tm.material_id,tm.material_name
    )tt
    left join
    (
    select t1.material_id,t2.material_name,count(*) no_curing_count from bpm_production t0
    left join bpp_plan_detail t1 on t1.objid = t0.plan_detail_id
    left join v_bbm_materialinfo t2 on t2.ObjId = t1.material_id
    left join bpm_shift_master t4 on t4.objid = t0.shift_master_id
    left join sbe_equip t5 on t5.objid = t4.equip_id
    left join ssb_class t6 on t6.objid = t4.class_id
    left join ssb_shift t7 on t7.objid =t4.shift_id
    left join bpp_plan t8 on t8.objid = t0.plan_id
    where not exists(select 1 from cpp_curing_production t3 where t3.green_tyre_no = t0.green_tyre_no)
    and t0.delete_flag=0
     ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t8.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t8.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[t4.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[t4.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[t4.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[t2.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
       </dynamic>
       <![CDATA[
     group by t1.material_id,t2.material_name
     ) td on td.material_id = tt.material_id
     group by tt.material_id,tt.material_name,tt.total_count,td.no_curing_count
    ]]>
     </select>

     <!--获取X光问题胎信息-->
     <select id="GetXglaryInfor" parameterClass="map" resultClass="Row">
       <![CDATA[
    SELECT  T2.GREEN_TYRE_NO,T3.EQUIP_ID,T4.EQUIP_NAME,T6.SHIFT_NAME,T7.DEFECTNAME,T8.MATERIAL_ID,T9.MATERIAL_NAME,T10.PLAN_DATE
     FROM  FQX_XCHECK_DETAIL T1
    INNER JOIN BPM_PRODUCTION T2 ON T1.TYRDID=T2.GREEN_TYRE_NO
    INNER JOIN BPM_SHIFT_MASTER T3 ON T2.SHIFT_MASTER_ID=T3.OBJID
    INNER JOIN SBE_EQUIP T4 ON T3.EQUIP_ID=T4.OBJID 
    INNER JOIN BSM_STORAGE_DETAIL T5 ON T2.GREEN_TYRE_NO=T5.GREEN_TYRE_NO
    INNER JOIN BSM_STORAGE_MAIN T8 ON T5.STORAGE_MAIN_ID=T8.OBJID
    INNER JOIN SSB_SHIFT T6 ON T3.SHIFT_ID=T6.OBJID
    INNER JOIN FQD_DEFECT_INFO T7 ON T1.DEFECTID=T7.OBJID
    INNER JOIN SBM_MATERIAL T9 ON T9.OBJID=T8.MATERIAL_ID
    INNER JOIN BPP_PLAN T10 ON T2.PLAN_ID=T10.OBJID
    WHERE T1.DELETE_FLAG=0
    ]]>
       <isNotNull property="where.OBJID" prepend="AND">
         <![CDATA[T1.OBJID = #where.OBJID#]]>
       </isNotNull>
       <isNotNull property="where.DeleteFlag" prepend="AND">
         <![CDATA[T1.DELETE_FLAG = #where.DeleteFlag#]]>
       </isNotNull>
       <isNotNull property="PlanTime" prepend="AND">
         <![CDATA[TO_CHAR(T10.PLAN_DATE,'YYYY-MM-DD')=#PlanTime#]]>
       </isNotNull>
       <isNotNull property="ShiftName" prepend="AND">
         <![CDATA[T6.SHIFT_NAME = #ShiftName#]]>
       </isNotNull>
       <isNotNull property="GreenTyreNo" prepend="AND">
         <![CDATA[T2.GREEN_TYRE_NO = #GreenTyreNo#]]>
       </isNotNull>
       <isNotNull property="EquipID" prepend="AND">
         <![CDATA[T3.EQUIP_ID = #EquipID#]]>
       </isNotNull>
     </select>


     <select id="GetSemisProductInfo2" parameterClass="map" resultClass="Row">
       <![CDATA[
       SELECT T.GREEN_TYRE_NO BARCODE,T1.EQUIP_ID,T2.MATERIAL_ID,T3.MATERIAL_NAME,T3.MATERIAL_CODE,T3.MINOR_TYPE_ID MATERIAL_TYPE_ID,
       T4.MINOR_TYPE_NAME MATERIAL_TYPE_NAME,T6.USER_NAME OPER_NAME,T5.EQUIP_NAME,T.END_TIME PRODUCE_TIME,
       T.END_TIME VALID_DATE FROM BPM_PRODUCTION T
        LEFT JOIN BPP_PLAN T1 ON T1.OBJID = T.PLAN_ID
        LEFT JOIN BPP_PLAN_DETAIL T2 ON T2.OBJID = T.PLAN_DETAIL_ID
        LEFT JOIN SBM_MATERIAL T3 ON T3.OBJID  =T2.MATERIAL_ID
        LEFT JOIN SBM_MATERIAL_MINOR_TYPE T4 ON T4.OBJID = T3.MINOR_TYPE_ID
        LEFT JOIN SBE_EQUIP T5 ON T5.OBJID = T1.EQUIP_ID
        LEFT JOIN SSB_USER T6 ON T6.OBJID = T.RECORD_USER_ID 
       ]]>
       <isNotNull property="cardNo" prepend="AND">
         <![CDATA[T.GREEN_TYRE_NO=#cardNo#]]>
       </isNotNull>
     </select>


     <select id="GetGreenTypeNoInfo1" parameterClass="map" resultClass="Row">
       <![CDATA[ 
 SELECT N.GREEN_TYRE_NO,N.TOOLING_BARCODE,N.MATERIAL_NAME,N.store_name,N.store_place_name,N.SHIFT_NAME,N.CLASS_NAME,N.EQUIP_NAME,N.BEGIN_TIME,N.END_TIME,
          N10.USER_NAME Z_NAME ,N11.USER_NAME F_NAME ,N12.USER_NAME B_NAME ,N.IS_FIRST_CAPTION,N.R_TIME,N.C_TIME
          FROM  
          (
     (
select t.green_tyre_no,t2.tooling_barcode,t3.material_name,t11.store_name ,t12.store_place_name,t5.shift_name,t6.class_name,t7.equip_name,t.begin_time,t.end_time
         ,MAX(DECODE(t8.WORKER_ID8,82,t8.WORKER_ID1,NULL)) EMP1,MAX(DECODE(t8.WORKER_ID8,83,t8.WORKER_ID1,NULL)) EMP2
         ,MAX(DECODE(t8.WORKER_ID8,85,t8.WORKER_ID1,NULL)) EMP3,
          CASE WHEN t.IS_FIRST = 1 THEN '是' WHEN t.IS_FIRST = 0 THEN '否' ELSE '' END IS_FIRST_CAPTION ,
             t9.scan_time R_TIME,t13.record_time C_TIME
     from bpm_production t 
     inner join bsm_tooling_load_detail t1 on t.green_tyre_no = t1.green_tyre_no
     left join bsm_tooling_load_main t2 on t2.objid = t1.main_id
     left join sbm_material t3 on t3.objid = t2.material_id
     LEFT JOIN BPM_SHIFT_MASTER t4 ON t4.OBJID = t.SHIFT_MASTER_ID
     LEFT JOIN SSB_SHIFT t5 ON t5.OBJID = t4.SHIFT_ID
     LEFT JOIN SSB_CLASS t6 ON t6.OBJID = t4.CLASS_ID
     LEFT JOIN SBE_EQUIP t7 ON t7.OBJID = t4.EQUIP_ID
     left JOIN BPM_SHIFT_DETAIL t8 ON t8.MASTER_ID = t4.OBJID
     left join BSM_STORAGE_DETAIL t9 on t9.green_tyre_no=t.green_tyre_no
     left join bsm_storage_main t10 on t10.objid = t9.storage_main_id
     left join bsm_store t11 on t11.objid = t10.store_id
     left join bsm_store_place t12 on t12.objid = t10.store_place_id
     LEFT JOIN BSM_STOCK_OUT_DETAIL t13 ON t13.GREEN_TYRE_NO = t9.GREEN_TYRE_NO
     WHERE T1.DELETE_FLAG=0 AND T2.DELETE_FLAG=0 AND T.DELETE_FLAG=0
     ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.greenTyreNo" prepend="AND">
           <![CDATA[t.GREEN_TYRE_NO = #where.greenTyreNo#]]>
         </isNotNull>
         <isNotNull property="where.greenTyreNoAndCar" prepend="AND">
           <![CDATA[t2.TOOLING_BARCODE=#where.greenTyreNoAndCar#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[
     GROUP BY  t.green_tyre_no,t2.tooling_barcode,t3.material_name,t11.store_name ,t12.store_place_name,t5.shift_name,t6.class_name
     
     ,t7.equip_name,t.begin_time,t.end_time,t.IS_FIRST,   t9.scan_time ,t13.record_time 
           ) N  
         LEFT JOIN SSB_USER N10 ON N10.OBJID = N.EMP1
         LEFT JOIN SSB_USER N11 ON N11.OBJID = N.EMP2
         LEFT JOIN SSB_USER N12 ON N12.OBJID = N.EMP3
         )
  ]]>
     </select>

     <update id="UpdateStateMainAmount" parameterClass="map">
       <![CDATA[
       update spp_tooling_state_main set load_amount = load_amount-1 where objid=#mainId# and load_amount>0
       ]]>
     </update>

     <select id="GetMainID" parameterClass="map" resultClass="Row">
       <![CDATA[  
         select main_id from bsm_tooling_load_detail
        where green_tyre_no=#GreenTyreNo# 
       ]]>
     </select>

     <delete id="DeleteBsmToolingLoadDetail" parameterClass="map" >
       <![CDATA[
      delete from bsm_tooling_load_detail where green_tyre_no=#GreenTyreNo# 
      ]]>
     </delete>

     <select id="GetDetailCount" parameterClass="map" resultClass="Row">
       <![CDATA[  
         select * from bsm_tooling_load_detail
        where MAIN_ID=#ToolMainID# 
       ]]>
     </select>

     <update id="UpdateToolingMainAmount" parameterClass="map">
       <![CDATA[
       update bsm_tooling_load_main set load_amount = load_amount-1 where objid=#ToolMainID# and load_amount>0
       ]]>
     </update>

     <delete id="DeleteBsmToolingLoadMain" parameterClass="map">
       <![CDATA[
       delete from bsm_tooling_load_main where objid = #ToolMainID# 
       ]]>
     </delete>

     <update id="UpdateBsmStorageMainAmount" parameterClass="map">
       <![CDATA[
       UPDATE BSM_STORAGE_MAIN SET STOCK_AMOUNT = STOCK_AMOUNT-1 WHERE OBJID =#MainId#
       ]]>
     </update>
     <update id="UpdateBsmStorageToolingAmount" parameterClass="map">
       <![CDATA[
       UPDATE bsm_storage_tooling SET load_amount = load_amount-1 WHERE OBJID =#StorageToolingId#
       ]]>
     </update>

     <select id="GetCuringProductionInfoOld" parameterClass="map" resultClass="Row">
       <![CDATA[
       select * from cpp_curing_production where delete_flag = 0
        ]]>
       <dynamic prepend="AND">
         <isNotNull property="greenTyreNo" prepend="AND">
           <![CDATA[green_tyre_no = #greenTyreNo#]]>
         </isNotNull>
       </dynamic>
     </select>
     
     <update id="UpdateCuringProductionInfo" parameterClass="map">
       <![CDATA[
       UPDATE cpp_curing_production SET green_tyre_no = #greenTyreNoNew# WHERE green_tyre_no =#greenTyreNo# and delete_flag = 0
       ]]>
     </update>

     <update id="SetSemisCardNoUsedState" parameterClass="map">
       <![CDATA[
       update hpp_semis_production set DUMMY8 = #State#
       where CARD_NO = #CardNo#
       ]]>
     </update>

     <update id="SetSemisCardNoUsedStateRubber" parameterClass="map">
       <![CDATA[
       update hpp_rubber_production set  DUMMY_5 = #State#
       where BARCODE = #CardNo#
       ]]>
     </update>

     <select id="GetMoldingEquipStorageInfo" parameterClass="map" resultClass="Row">
       <![CDATA[
        select rownum - 1 rowno,t2.* from (
        select a.card_no,a.dummy2 material_id, c.sap_code ,a.record_time instock_time,b.begin_time,b.end_time,d.XRXCControl,d.XRXCTime
        from hpp_storage_detail a
        left join hpp_semis_production b on a.card_no = b.card_no and b.delete_flag = 0
        left join sbm_material c on a.dummy2 = c.objid
        left join (select max(decode(t.config_key,'MoldingEquipStorageXRXCControl',t.config_value)) XRXCControl
                         ,max(decode(t.config_key,'MoldingEquipStorageXRXCTime',t.config_value)) XRXCTime
                   from ssb_config t
                   where config_key in ('MoldingEquipStorageXRXCControl','MoldingEquipStorageXRXCTime')) d on 1=1
        where 1=1
        and a.card_no = #CardNo#
        
        union all 
        
        select t1.* from (
        select a.card_no,a.dummy2 materID, c.sap_code ,a.record_time instock_time,b.begin_time,b.end_time,d.XRXCControl,d.XRXCTime
        from hpp_storage_detail a
        left join hpp_semis_production b on a.card_no = b.card_no and b.delete_flag = 0
        left join sbm_material c on a.dummy2 = c.objid
        left join (select max(decode(t.config_key,'MoldingEquipStorageXRXCControl',t.config_value)) XRXCControl
                         ,max(decode(t.config_key,'MoldingEquipStorageXRXCTime',t.config_value)) XRXCTime
                   from ssb_config t
                    where config_key in ('MoldingEquipStorageXRXCControl','MoldingEquipStorageXRXCTime')) d on 1=1
        where 1=1
        and ((nvl(b.dummy8,'0') in ('0','1') and b.qty = b.left_qty and a.used_flag = 0) or (nvl(b.dummy8,'0') in ('11') and b.qty = b.left_qty ))
        and a.dummy2 = #MaterialID# 
        and a.store_place_id = (select store_place_id from hpp_storage_detail where card_no = #CardNo# )
        order by b.end_time
        ) t1 where rownum <= 1
        ) t2       
      ]]>
     </select>
     <select id="GetMoldingEquipStorageInfolr" parameterClass="map" resultClass="Row">
       <![CDATA[
        select rownum - 1 rowno,t2.* from (
        select a.card_no,a.dummy2 material_id, c.sap_code ,a.record_time instock_time,b.begin_time,b.end_time,d.XRXCControl,d.XRXCTime
        from hpp_storage_detail a
        left join hpp_semis_production b on a.card_no = b.card_no and b.delete_flag = 0
        left join sbm_material c on a.dummy2 = c.objid
        left join (select max(decode(t.config_key,'MoldingEquipStorageXRXCControl',t.config_value)) XRXCControl
                         ,max(decode(t.config_key,'MoldingEquipStorageXRXCTime',t.config_value)) XRXCTime
                   from ssb_config t
                   where config_key in ('MoldingEquipStorageXRXCControl','MoldingEquipStorageXRXCTime')) d on 1=1
        where 1=1
        and a.card_no = #CardNo#  and b.dummy5=#lrFlag# 
        
        union all 
        
        select t1.* from (
        select a.card_no,a.dummy2 materID, c.sap_code ,a.record_time instock_time,b.begin_time,b.end_time,d.XRXCControl,d.XRXCTime
        from hpp_storage_detail a
        left join hpp_semis_production b on a.card_no = b.card_no and b.delete_flag = 0
        left join sbm_material c on a.dummy2 = c.objid
        left join (select max(decode(t.config_key,'MoldingEquipStorageXRXCControl',t.config_value)) XRXCControl
                         ,max(decode(t.config_key,'MoldingEquipStorageXRXCTime',t.config_value)) XRXCTime
                   from ssb_config t
                    where config_key in ('MoldingEquipStorageXRXCControl','MoldingEquipStorageXRXCTime')) d on 1=1
        where 1=1
        and ((nvl(b.dummy8,'0') in ('0','1') and b.qty = b.left_qty and a.used_flag = 0) or (nvl(b.dummy8,'0') in ('11') and b.qty = b.left_qty ))
        and a.dummy2 = #MaterialID#    and b.dummy5=#lrFlag# 
        and a.store_place_id = (select store_place_id from hpp_storage_detail where card_no = #CardNo# )
        order by b.end_time
        ) t1 where rownum <= 1
        ) t2       
      ]]>
     </select>

     <!--胎胚未入库-->
     <select id="GetNoStockinInfo" parameterClass="map" resultClass="Row">
       <![CDATA[
 select tt.material_id,tt.material_name,tt.total_count,nvl(td.no_stockin_count,0)no_stockin_count from 
    (select tm.material_id,tm.material_name,count(*) total_count from bpm_production t 
    left join bpp_plan_detail tpd on tpd.objid = t.plan_detail_id
    left join v_bbm_materialinfo tm on tm.ObjId = tpd.material_id
    left join bpm_shift_master tsm on tsm.objid = t.shift_master_id
    left join sbe_equip te on te.objid = tsm.equip_id
    left join ssb_class tc on tc.objid = tsm.class_id
    left join ssb_shift ts on ts.objid =tsm.shift_id
    left join bpp_plan tp on tp.objid = t.plan_id
    where t.delete_flag=0
    ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[tp.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[tp.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[tsm.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[tsm.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[tsm.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[tm.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
       </dynamic>
       <![CDATA[
     group by tm.material_id,tm.material_name
    )tt
    left join
    (
    select t1.material_id,t2.material_name,count(*) no_stockin_count from bpm_production t0
    left join bpp_plan_detail t1 on t1.objid = t0.plan_detail_id
    left join v_bbm_materialinfo t2 on t2.ObjId = t1.material_id
    left join bpm_shift_master t4 on t4.objid = t0.shift_master_id
    left join sbe_equip t5 on t5.objid = t4.equip_id
    left join ssb_class t6 on t6.objid = t4.class_id
    left join ssb_shift t7 on t7.objid =t4.shift_id
    left join bpp_plan t8 on t8.objid = t0.plan_id
    where not exists(select 1 from bsm_stock_in_detail t3 where t3.green_tyre_no = t0.green_tyre_no)
    and t0.delete_flag=0  and (t0.remark not like '%修改%' and t0.remark not like '%替换%' and t0.remark not like '%补录%' ) 
     ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t8.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t8.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[t4.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[t4.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[t4.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[t2.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
       </dynamic>
       <![CDATA[
 group by t1.material_id,t2.material_name
     ) td on td.material_id = tt.material_id
     group by tt.material_id,tt.material_name,tt.total_count,td.no_stockin_count
     order by no_stockin_count desc
    ]]>
     </select>
     <!--胎胚未入库明细-->
     <select id="GetNoStockinDetail" parameterClass="map" resultClass="Row">
       <![CDATA[
   select t.green_tyre_no,t.material_id,t.material_name,T.EQUIP_NAME,T.CLASS_NAME,T.SHIFT_NAME,t.tooling_barcode,t10.user_name emp1_name,t11.user_name emp2_name,
   t12.user_name emp3_name,t.record_time from
  (
  (select t0.green_tyre_no,t0.record_time,t1.material_id,t2.material_name,T5.EQUIP_NAME,T6.CLASS_NAME,T7.SHIFT_NAME,T11.tooling_barcode,
   max(decode(t9.worker_id8,82,t9.worker_id1,null)) emp1,max(decode(t9.worker_id8,83,t9.worker_id1,null)) emp2,
   max(decode(t9.worker_id8,85,t9.worker_id1,null)) emp3
    from bpm_production t0
    left join bpp_plan_detail t1 on t1.objid = t0.plan_detail_id
    left join v_bbm_materialinfo t2 on t2.ObjId = t1.material_id
    left join bpm_shift_master t4 on t4.objid = t0.shift_master_id
    left join sbe_equip t5 on t5.objid = t4.equip_id
    left join ssb_class t6 on t6.objid = t4.class_id
    left join ssb_shift t7 on t7.objid =t4.shift_id
    left join bpp_plan t8 on t8.objid = t0.plan_id
    LEFT JOIN BPM_SHIFT_DETAIL T9 ON T9.MASTER_ID = T4.OBJID
    LEFT JOIN BSM_TOOLING_LOAD_DETAIL T10 ON T0.GREEN_TYRE_NO = T10.GREEN_TYRE_NO
    left join BSM_TOOLING_LOAD_MAIN T11 on T11.OBJID = T10.MAIN_ID
    where not exists(select 1 from bsm_stock_in_detail t3 where t3.green_tyre_no = t0.green_tyre_no)
    and t0.delete_flag=0   and (t0.remark not like '%修改%' and t0.remark not like '%替换%' and t0.remark not like '%补录%' ) 
    ]]>
       <dynamic prepend="AND">
         <isNotNull property="where.BeginTime" prepend="AND">
           <![CDATA[t8.plan_date >= #where.BeginTime#]]>
         </isNotNull>
         <isNotNull property="where.EndTime" prepend="AND">
           <![CDATA[t8.plan_date <= #where.EndTime#]]>
         </isNotNull>
         <isNotNull property="where.ShiftID" prepend="AND">
           <![CDATA[t4.shift_id = #where.ShiftID#]]>
         </isNotNull>
         <isNotNull property="where.ClassID" prepend="AND">
           <![CDATA[t4.class_id = #where.ClassID#]]>
         </isNotNull>
         <isNotNull property="where.EquipID" prepend="AND">
           <![CDATA[t4.equip_id = #where.EquipID#]]>
         </isNotNull>
         <isNotNull property="where.MaterialName" prepend="AND">
           <![CDATA[t2.material_name like '%'||#where.MaterialName# ||'%']]>
         </isNotNull>
         <isNotNull property="where.MaterialID" prepend="AND">
           <![CDATA[t1.material_id = #where.MaterialID#]]>
         </isNotNull>
       </dynamic>
       <![CDATA[
    group by t0.green_tyre_no,t0.record_time,t1.material_id,t2.material_name,T5.EQUIP_NAME,T6.CLASS_NAME,T7.SHIFT_NAME,T11.tooling_barcode
    )t
    left join ssb_user t10 on t10.objid = t.emp1
    left join ssb_user t11 on t11.objid = t.emp2
    left join ssb_user t12 on t12.objid = t.emp3
    )
    ]]>
     </select>

     <insert id="InsertFXJJ" parameterClass="map" resultClass="Row">
       <![CDATA[
                insert into bqc_qcrecord (objid,tyreid,gradeid,seqid,new_flag,defect_id1,record_user_id,dummy1,state_flag,material_id)
           values(seq_bqc_qcrecord.nextval,#tyreno#,'2',1,1,#DefectId1#,#userid#,'1','3',
           (select b.material_id from bpm_production a,bpp_plan_detail b where a.plan_detail_id = b.objid and a.delete_flag = 0 and a.green_tyre_no = #tyreno#))
      ]]>
     </insert>
     <insert id="InsertFXBJT" parameterClass="map" resultClass="Row">
       <![CDATA[
                insert into bqc_qcrecord (objid,tyreid,gradeid,seqid,new_flag,record_user_id,dummy1,dummy2,dummy3,state_flag,material_id)
           values(seq_bqc_qcrecord.nextval,#tyreno#,'2',1,1,#userid#,'1',#xm#,#bw#,'3',
           (select b.material_id from bpm_production a,bpp_plan_detail b where a.plan_detail_id = b.objid and a.delete_flag = 0 and a.green_tyre_no = #tyreno#))
      ]]>
     </insert>


     <select id="GetEmp" parameterClass="map" resultClass="Row">
       <![CDATA[
          SELECT T1.USER_NAME FROM BPM_SHIFT_DETAIL T 
          LEFT JOIN SSB_USER T1 ON T1.OBJID = T.WORKER_ID1
          WHERE T.DELETE_FLAG=0
       ]]>
       <dynamic prepend="AND">
         <isNotNull property="shiftMasterId" prepend="AND">
           <![CDATA[T.MASTER_ID=#shiftMasterId#]]>
         </isNotNull>
         <isNotNull property="workId" prepend="AND">
           <![CDATA[T.WORKER_ID8=#workId#]]>
         </isNotNull>
       </dynamic>
     </select>

   </statements>
</sqlMap>
